---
title: 接口测试
date: 2023-2-12 09:34:49
tags:
    - 软件测试

categories:
    - 软件测试    

cover: /img/rice.jpg
---
## 1. 回顾

### 1.1 URL

**URL**： 统一资源定位符

**格式**： 协议://hostname:port/path?参数=值&参数2=值

**默认端口号**可以不写

http:80

https:443

### 1.2 HTTP / HTTPS

超文本传输协议。基于响应和请求的应用层协议

规定了客户端和服务器之间信息的传递规范。

组成：

* HTTP请求定义了请求数据格式
* HTTP响应定义了响应数据格式

#### 1.2.1 HTTP 请求行

位于请求数据的第一行。表明了请求方式，访问的资源，协议版本

格式：[请求方法] [url] [协议/协议版本]

常用请求方法：

1. POST 在服务器新建一个资源
2. GET 从服务器获取资源
3. DELETE 从服务器删除资源
4. PUT 在服务器更新资源

#### 1.2.2 HTTP 请求头 

> Request-header

位于请求数据的**第二行到空白行之间**。作用是通知服务器客户端的请求信息。请求头部由**键值对**组成。每行一对。

常见的参数：

Host、User-Agent、Content-Type

Content-Type用于表明**请求体**的数据类型，通常有：

* text/html
* image/jpeg
* application/json
* application/x-www-form-urlencoded
* mutipart/form-data

#### 1.2.3 HTTP 请求体

> Request-body
>
> body-parameters

请求体就是请求下面的空白行下面的内容。常配合的请求头有上面讲的Content-Type，标明请求体的类型。还有Content-Length，标明请求体的长度。

* 请求报文可以没有请求体

#### 1.2.4 HTTP 响应 - 状态行

处于响应数据第一行。用于描述服务器处理结果

格式：【协议版本号】【状态码】【状态消息】

状态码：三位数字

* 1xx: 指示信息
* 2xx: 成功
* 3xx: 重定向
* 4xx: 客户端错误
* 5xx: 服务端错误

#### 1.2.5 HTTP 响应 - 响应头

和请求头的位置一样。用于描述客户端想要的一些附加信息。同样由键值对组成

#### 1.2.6 HTTP 响应 - 响应体

和请求体位置一样。数据类型类似。是服务器返回的数据实体。

## 2. Charles

> 下载地址：https://www.charlesproxy.com/download/
>
> 激活：https://www.zzzmode.com/mytools/charles/

### 2.1 什么是Charles

Charles，是一个基于**HTTP协议**的代理服务器。通过成为电脑或者是浏览器的代理，从而**截取请求和请求结果**，以达到抓包分析的目的。

### 2.2 Charles 工作流程

Charles的工作流程，其实就是在主机和互联网之间，加一个代理服务器。主机发送请求的时候，先发到charles上，由charles转发给服务器。接受时候同理。

### 2.3 Charles功能

* 支持HTTP和HTTPS代理
* 支持**流量控制**（弱网环境）
* 支持接口**并发**请求
* 支持**重发网络请求**
* 支持断点调试（构建异常的测试场景）

### 2.4 补票

## 3. 接口规范

### 3.1 传统接口风格

URL体现了业务增删改查操作。

http://localhost:80/user/getAllUsers

https://localhost:80/deleteUser?id=1

这种就是传统的接口

### 3.2 RESTful接口风格

URL中只**定义了需要操作的对象**。

https://localhost:80/app/users/1 : 操作user集合的中编号为1的对象。

* 请求API的URL用来定位**资源**（也就是对象）。
* 通过HTTP请求方式，来对资源进行增删改查操作。
  * 查：GET
  * 增：POST
  * 改：PUT
  * 删：DELETE

* 状态码遵循HTTP状态码协议。

## 4. 业务流程 vs 单个模块

拿到一个项目后，**先测试**业务流程，确保**核心功能**正常。

### 4.1 如何设计业务流程测试用例

1. 根据流程图，找业务路径
2. 根据业务路径分析对应的接口请求
3. 将业务路径转化为接口测试用例

* 找出现问题的点。正常通过的只用测一次（一路走到底）

因此，对于下面这个新增合同业务，我们可以设计出以下用例：

![image-20231012013204347](../img/image-20231012013204347.png)

1. 合同新增成功：登录（成功）-> 添加课程（成功）-> 上传合同（成功）-> 新增合同（成功
2. 合同新增失败（登录失败）
3. 合同新增失败 （添加课程失败）：登陆（成功）
4. 合同新增失败 （上传合同失败）：登录（成功）-> 添加课程（成功）
5. 合同新增失败 （新增合同失败）：登录（成功）-> 添加课程（成功）-> 上传合同（成功）

## 5. 接口文档

> 接口API文档一般由后端开发编写，用于描述接口信息。
>
> ![image-20231012015303012](../img/image-20231012015303012.png)

对于接口测试来讲，主要就是分析接口文档中的三点：

1.  接口之间的依赖关系
2.  接口请求（URL，请求方法，请求头，请求参数类型，请求参数）
3.  接口响应（状态码，响应信息）



* 基本就是跟着接口文档，在测试用例里面复制黏贴就行。接口文档里没写的，测试用例里用“/”占位。

![image-20231012020112675](../img/image-20231012020112675.png)

## 6. Postman 
> 一款接口调试工具

### 6.1 Demo:验证码接口

**URL**: http://kdtx-test.itheima.net/api/captchaImage

* 设置请求方式 (GET)
* 输入接口地址 (...)
* 点击发送请求
* 查看响应结果

### 6.2 Demo: 登录接口

**URL**: http://kdtx-test.itheima.net/api/login 方法： POST

**请求头**： Content-Type： application/json

**请求体**： {"username":"admin", "password":"HM_2023_test","code":"2","uuid":"验证码接口中uuid请求结果"}

* 设置请求方式 (GET)
* 输入接口地址 (...)
* 点击发送请求
* 查看响应结果

---

**问题**： 每次使用登录接口，都需要**手动**复制验证码接口的返回结果，很麻烦

Postman为我们提供了一个**公共容器**，用于保存相关联的数据。

### 6.3 环境变量

![image-20231012150414097](../img/image-20231012150414097.png)



#### 6.3.1 通过javascript操作响应json，并存入环境变量

Postman**内置Test**，可以运行Javascript。通过这一点，可以动态地获取并保存环境变量



##### 6.3.1.1 Demo1: 将获取验证码时的uuid存入环境变量，并在登录时填写到requestBody中

![image-20231012152302176](../img/image-20231012152302176.png)

![image-20231012152314404](../img/image-20231012152314404.png)



##### 6.3.1.1 Demo: 将登录成功后的token存入环境变量，并在添加课程时候填入 RequestHeader中。

![image-20231012175222772](../img/image-20231012175222772.png)

![image-20231012175230820](../img/image-20231012175230820.png)



### 6.4 处理mutipart/form-data数据

接口可能会这样子写

![image-20231013020924815](../img/image-20231013020924815.png)

这时候请求体类型就得是form-data类型了。Key看文档，file看文档文件路径。

![image-20231013021007971](../img/image-20231013021007971.png)

这里上传接口又依赖登录接口请求成功后，返回的token。因此，需要在登录接口中将token存入环境变量

![image-20231013021122908](../img/image-20231013021122908.png)

并在上传接口的Request-Headers，添加Authorization：{{token}}



### 6.5 Postman中的Request Param

![image-20231013224552169](../img/image-20231013224552169.png)



### 6.6 批量执行

> 这些合同查询、上传、新增操作，都依赖于登录时候提供的token进行鉴权。问题是，用户登录是会过期的。我们不可能每次要去进行操作，都手动把每个接口的流程走一遍，因此，postman提供了批量执行测试用例。

![image-20231013230802520](../img/image-20231013230802520.png)



## 7. 设计接口用例

对于 **单接口测试**，设计思路通常分为两类： **正向测试**和**逆向（反向）测试**

### 7.1 正向测试

包含： 

* 必填参数 P2
* 全部参数 p2

### 7.2 逆向测试

包含：

* 参数数据为空 p3
* 参数类型不符 p3
* 参数长度不符 p3
* 业务规则不符 p3

正向测试的优先级**永远高于**逆向测试

逆向测试可以理解成**对正向测试里的参数的对立面进行测试**

e.g. 登录接口测试用例

![image-20231014014917998](../img/image-20231014014917998.png)



### 7.3 Postman按模块管理测试用例

![image-20231014020213977](../img/image-20231014020213977.png)

按照上面的箭头，先在Collection中创建folder，然后再folder中创建对应接口的request测试用例。

下面是对于**登录接口**的**用户名**设计的**三个**正向和反向测试用例

![image-20231014020042107](../img/image-20231014020042107.png)



#### 补票：Postman断言

> Postman提供了test()方法，用于自动地检测response中的结果是否与预期结果一致。

常用断言包括：

* 响应状态码(Status code)

  ![image-20231014020902573](../img/image-20231014020902573.png)

  **直接点击对应snippet就会自动再Tests编辑区域生成 **

* 响应包含指定字符串 (Contains string)

* JSON断言（JSON value check)

  写完之后发送下，如果符合预期结果的话，应该是绿色。

  

![image-20231014022802984](../img/image-20231014022802984.png)

#### 补票：Postman参数化

> 从上面的断言例子可以看出。如果对同一接口进行正反向测试时候，每次测试都需要将Tests内的代码或者是headers、body中的值进行复制黏贴。很麻烦。因此，postman提供了参数化，可以直接准备好的数据文件中，读取数据

步骤：

1. 准备数据文件

2. 引用数据文件数据

   headers、body：{{key}}

   代码：data.key

3. 在**批量执行**的页面，select file选择数据文件。



JSON数据格式：

```json
[
    {"username":"admin", "password":"HM_2023_test", "status":"200", "contain_message":"作成功", "msg": "操作成功"},
    {"username":"", "password":"HM_2023_test", "status":"500", "contain_message":"作成功", "msg": "用户不存在/密码错误"},
    {"username":"admin1", "password":"HM_2023_test", "status":"500", "contain_message":"作成功", "msg": "用户不存在/密码错误"}
]
```

![image-20231014034148547](../img/image-20231014034148547.png)

注意，在编写json数据时，务必看好接口文档里的参数类型。如果是string类型则不要忘了双引号。如果是数字类型则不用双引号。

这里，如果将"status"设为String类型的"200"，则会导致测试用例无法通过。

如图：

![image-20231014034455018](../img/image-20231014034455018.png)

![image-20231014034510599](../img/image-20231014034510599.png)



> 下面的用例，有时间可以往postman里填下，练练手。重要的还是看怎么设计用例。填数据没难度。

#### 7.3.1 Demo: 课程添加接口的用例设计

![image-20231014040059430](../img/image-20231014040059430.png)

因为这个接口依赖于登录成功后返回的token，因此，正向中的两个用例需要补充一下说明：是在登录成功的前提下,进行.....。同理，逆向中，还需要添加一条测试用例：![image-20231014040254573](../img/image-20231014040254573.png)





#### 7.3.2 课程查询接口的用例设计

![image-20231014054102698](../img/image-20231014054102698.png)

> 对应的用例文档

![image-20231014054644739](../img/image-20231014054644739.png)

![image-20231014054559197](../img/image-20231014054559197.png)



#### 7.3.3 课程修改接口用例设计

![image-20231014055926821](../img/image-20231014055926821.png)

![image-20231014060539030](../img/image-20231014060539030.png)



#### 7.3.4 课程删除接口测试用例设计

![image-20231014061221536](../img/image-20231014061221536.png)

![image-20231014061610452](../img/image-20231014061610452.png)

这里的id是**路径参数**

##### 7.3.4.1 路径参数

> PathVariable

URL中**末尾一级**的参数

如： http://kdtx-test.itheima.net/api/clues/course/111

在Postman中有两种方式添加Path Variable。第一种就是**直接在url中添加**，第二种是**url末尾加**```:id```

![image-20231014061840143](../img/image-20231014061840143.png)



以上内容为接口测试的基础理论与样例。下面是使用TestNG

------

